# Диагностика / selftest

Диагностический пакет собирает информацию о сборке и выполняет набор проверок, записывая артефакты в один каталог.

## Запуск

```bash
# Полный пакет диагностики
./incline3d --diagnostics --out ./out/diagnostics

# Без рендера (например, в core-only сборке)
./incline3d --diagnostics --no-images --out ./out/diagnostics
```

## Артефакты

```
diagnostics/
├── report.json          # Машинный отчёт (schema_version = 1.0.0)
├── report.md            # Человекочитаемый отчёт
└── images/              # Изображения selftest (при наличии GUI)
    ├── axonometry.png
    ├── plan.png
    └── vertical.png
```

Файлы пишутся атомарно (временный файл + rename). Каталог указывается флагом `--out`, при отсутствии — создаётся во временной директории.

## Состав проверок

- **Сборка и версия** — фиксирует версию приложения, тип сборки, платформу, наличие GUI.
- **Файловая система** — пробная запись/чтение файла в каталоге артефактов.
- **Расчёт траектории** — обработка встроенного демо-набора, проверка отсутствия NaN/inf.
- **Обработка пустых данных** — пустой вход не приводит к сбоям.
- **Визуальный selftest** — рендер изображений (SKIPPED при `BUILD_GUI=OFF` или `--no-images`).

Все строки отчётов — на русском, данные путей используют `std::filesystem::path` (кроссплатформенно, без POSIX-вызовов).

## Статусы

- `OK` — проверка успешно выполнена;
- `WARN` — предупреждение (не используется в текущем пакете);
- `FAIL` — ошибка (код возврата CLI ≠ 0);
- `SKIPPED` — проверка пропущена (например, без GUI).

## Тесты

- `tests/unit/test_diagnostics_core.cpp` — генерация отчёта без GUI.
- `tests/integration/test_diagnostics_cli.cpp` — полный пакет с изображениями (при `BUILD_GUI=ON`).
